var G=Object.defineProperty;var O=r=>{throw TypeError(r)};var W=(r,a,t)=>a in r?G(r,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[a]=t;var H=(r,a,t)=>W(r,typeof a!="symbol"?a+"":a,t),R=(r,a,t)=>a.has(r)||O("Cannot "+t);var d=(r,a,t)=>(R(r,a,"read from private field"),t?t.call(r):a.get(r)),m=(r,a,t)=>a.has(r)?O("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(r):a.set(r,t),p=(r,a,t,s)=>(R(r,a,"write to private field"),s?s.call(r,t):a.set(r,t),t),n=(r,a,t)=>(R(r,a,"access private method"),t);import{C as X}from"./component.js";import{T as S,Q,C as D}from"./events.js";import{d as Z,h as b,f as j}from"./utilities.js";import{s as x,m as $}from"./section-renderer.js";import"./morph.js";var h,w,y,e,P,L,C,J,V,K,B,_,E,U,T,F,A,N,Y,k,M;class tt extends X{constructor(){super(...arguments);m(this,e);H(this,"requiredRefs",["variantRows","confirmationPanel","totalInfo","errorContainer","errorText","successContainer","successText"]);m(this,h,null);m(this,w);m(this,y);m(this,L,t=>{if(t.key!=="Enter"||!n(this,e,P).call(this,t.target))return;t.preventDefault();const s=Array.from(this.querySelectorAll('input[type="number"][data-cart-quantity]')).filter(g=>g instanceof HTMLElement&&g.offsetParent!==null);if(s.length<=1)return;const i=s.indexOf(t.target);if(i===-1)return;const o=t.shiftKey?-1:1,c=(i+o+s.length)%s.length,l=s[c];t.target.blur(),l instanceof HTMLInputElement&&l.select()});m(this,C,t=>{(t.key==="Tab"||t.key==="Enter")&&n(this,e,P).call(this,t.target)&&n(this,e,J).call(this,t.target)})}get currentPage(){if(this.refs.paginationNav&&this.refs.paginationNav.dataset.current_page){const t=parseInt(this.refs.paginationNav.dataset.current_page,10);if(!isNaN(t))return t}return 1}get cartVariantIds(){const t=this.dataset.cartVariantIds;return t?JSON.parse(t):[]}connectedCallback(){super.connectedCallback(),p(this,w,Z(n(this,e,V).bind(this),300)),p(this,y,n(this,e,K).bind(this)),this.addEventListener(S.quantitySelectorUpdate,d(this,w)),document.addEventListener(S.cartUpdate,d(this,y)),this.addEventListener("keydown",d(this,L),!0),this.addEventListener("keyup",d(this,C),!0)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener(S.quantitySelectorUpdate,d(this,w)),document.removeEventListener(S.cartUpdate,d(this,y)),this.removeEventListener("keydown",d(this,L),!0),this.removeEventListener("keyup",d(this,C),!0),d(this,h)?.abort()}async onPaginationControlClick(t,s){s.preventDefault();const i=this.dataset.sectionId;if(!this.dataset.url||!i)return;d(this,h)?.abort(),p(this,h,new AbortController);const o=new URL(this.dataset.url,window.location.origin);for(const[c,l]of Object.entries(t))o.searchParams.set(c,l);await x.renderSection(i,{url:o}),n(this,e,Y).call(this)}async onLineItemRemove(t,s){s.preventDefault();const i=this.refs.variantRows.find(c=>c.dataset.variantId===String(t));if(!(i instanceof HTMLElement))return;const o=i.querySelector('input[type="number"]');o instanceof HTMLInputElement&&(o.value="0",o.dispatchEvent(new Q(0,Number(o.dataset.cartLine))))}async onRemoveAll(t){t.preventDefault();const s=this.cartVariantIds;n(this,e,A).call(this),n(this,e,T).call(this),n(this,e,N).call(this,s),d(this,h)?.abort(),p(this,h,new AbortController);try{const i={};if(s.length>0)for(const q of s)i[String(q)]=0;if(Object.keys(i).length===0){b(this);return}const o=n(this,e,M).call(this),c=new URL(window.location.pathname,window.location.origin);c.searchParams.set("page",this.currentPage.toString());const l=JSON.stringify({updates:i,sections:o.join(","),sections_url:c.pathname+c.search}),u=await(await fetch(Theme.routes.cart_update_url,{...j("json",{body:l}),signal:d(this,h).signal})).text(),f=JSON.parse(u);b(this),f.errors?n(this,e,U).call(this,f.errors):(n(this,e,k).call(this,f),n(this,e,E).call(this,!1),document.dispatchEvent(new D(f,this.id,{source:"quick-order-remove-all",sections:f.sections})))}catch(i){if(i.name!=="AbortError")throw b(this),i}}showRemoveAllConfirmation(t){t.preventDefault(),n(this,e,E).call(this,!0)}hideRemoveAllConfirmation(t){t.preventDefault(),n(this,e,E).call(this,!1)}}h=new WeakMap,w=new WeakMap,y=new WeakMap,e=new WeakSet,P=function(t){return t instanceof HTMLInputElement&&t.matches('input[type="number"][data-cart-quantity]')},L=new WeakMap,C=new WeakMap,J=function(t){t.scrollIntoView({block:"center",behavior:"smooth"})},V=async function(t){if(!(t instanceof Q)||!(t.target instanceof Node)||!this.contains(t.target))return;const{quantity:s}=t.detail,i=t.target;if(!(i instanceof HTMLElement))return;const o=this.refs.variantRows.find(u=>u.contains(i));if(!o)return;const c=o.dataset.variantId;if(!c)return;const l=o.querySelector("input[data-cart-quantity]"),g=l&&parseInt(l.dataset.cartQuantity||"0")||0;if(n(this,e,A).call(this),n(this,e,T).call(this),g!==s){n(this,e,N).call(this,[c]),n(this,e,B).call(this),d(this,h)?.abort(),p(this,h,new AbortController);try{const u={};u[c]=s;const f=new URL(window.location.pathname,window.location.origin);f.searchParams.set("page",this.currentPage.toString());const q=JSON.stringify({updates:u,sections:n(this,e,M).call(this).join(","),sections_url:f.pathname+f.search}),z=await(await fetch(Theme.routes.cart_update_url,{...j("json",{body:q}),signal:d(this,h).signal})).text(),I=JSON.parse(z);if(b(this),I.errors){if(n(this,e,U).call(this,I.errors),this.dataset.sectionId){const v=new URL(window.location.href);v.searchParams.set("page",this.currentPage.toString()),await x.renderSection(this.dataset.sectionId,{cache:!1,url:v})}}else{n(this,e,k).call(this,I);const v=s-g;v>0&&n(this,e,F).call(this,v),document.dispatchEvent(new D(I,this.id,{source:"quick-order-quantity",variantId:c,sections:I.sections}))}}catch(u){if(u.name!=="AbortError")throw n(this,e,_).call(this),b(this),u}}},K=async function(t){if(!(t.detail?.source==="quick-order-quantity"&&t.detail?.sourceId===this.id)&&(n(this,e,_).call(this),d(this,h)?.abort(),p(this,h,new AbortController),!(t.detail?.data?.sections&&this.dataset.sectionId&&(n(this,e,k).call(this,t.detail.data),t.detail.data.sections[this.dataset.sectionId]))&&this.dataset.sectionId)){const s=new URL(window.location.href);s.searchParams.set("page",this.currentPage.toString()),await x.renderSection(this.dataset.sectionId,{cache:!1,url:s})}},B=function(){this.classList.add("quick-order-list-disabled")},_=function(){this.classList.remove("quick-order-list-disabled")},E=function(t){this.refs.confirmationPanel.classList.toggle("hidden",!t),this.refs.totalInfo.classList.toggle("confirmation-visible",t)},U=function(t){this.refs.errorText.textContent=t,this.refs.errorContainer.classList.remove("hidden")},T=function(){this.refs.errorContainer.classList.add("hidden")},F=function(t){n(this,e,T).call(this);const s=Theme?.translations?.items_added_to_cart_one||"1 item added to cart",i=Theme?.translations?.items_added_to_cart_other||"{{ count }} items added to cart",o=t===1?s:i.replace("{{ count }}",t.toString());this.refs.successText.textContent=o,this.refs.successContainer.classList.remove("hidden")},A=function(){this.refs.successContainer.classList.add("hidden")},N=function(t){for(const i of t){const o=this.refs.variantRows.find(c=>c.dataset.variantId===String(i));o&&o.querySelector(".variant-item__total-price")?.shimmer()}this.querySelector('text-component[ref="totalPrice"]')?.shimmer()},Y=function(){requestAnimationFrame(()=>{const t=this.getBoundingClientRect().top;window.scrollTo({top:t+window.scrollY,behavior:"smooth"})})},k=function(t){if(t.sections&&this.dataset.sectionId){const s=t.sections[this.dataset.sectionId];s&&$(this.dataset.sectionId,s)}},M=function(){const t=[];this.dataset.sectionId&&t.push(this.dataset.sectionId);const s=document.querySelectorAll("cart-items-component");for(const i of s)i instanceof HTMLElement&&i.dataset.sectionId&&!t.includes(i.dataset.sectionId)&&t.push(i.dataset.sectionId);return t};customElements.get("quick-order-list-component")||customElements.define("quick-order-list-component",tt);
