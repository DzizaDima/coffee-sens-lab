var R=Object.defineProperty;var U=i=>{throw TypeError(i)};var B=(i,r,t)=>r in i?R(i,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[r]=t;var v=(i,r,t)=>B(i,typeof r!="symbol"?r+"":r,t),E=(i,r,t)=>r.has(i)||U("Cannot "+t);var n=(i,r,t)=>(E(i,r,"read from private field"),t?t.call(i):r.get(i)),d=(i,r,t)=>r.has(i)?U("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(i):r.set(i,t),A=(i,r,t,e)=>(E(i,r,"write to private field"),e?e.call(i,t):r.set(i,t),t),c=(i,r,t)=>(E(i,r,"access private method"),t);import{O as N}from"./overflow-list.js";import{V as _}from"./variant-picker.js";import{C as D}from"./component.js";import{m as K,A as F,B as Q,d as z}from"./utilities.js";import{T as I,S as G}from"./events.js";import{m as Y}from"./morph.js";var p,w,s,y,g,L,P,T,q,O,M,x,u,b,k;class V extends D{constructor(){super(...arguments);d(this,s);v(this,"requiredRefs",["productCardLink"]);d(this,p,()=>{this.refs.quickAdd?.fetchProductPage(this.productPageUrl)});d(this,w,(t,e)=>{if(t instanceof MouseEvent&&(t.metaKey||t.ctrlKey||t.shiftKey||t.button===1)){t.preventDefault(),window.open(e.href,"_blank");return}else window.location.href=e.href});d(this,g,()=>{this.removeEventListener("pointerenter",n(this,p)),this.removeEventListener("focusin",n(this,p)),F()&&(this.addEventListener("pointerenter",n(this,p)),this.addEventListener("focusin",n(this,p)))});d(this,L,t=>{t.target!==this.variantPicker&&this.variantPicker?.updateSelectedOption(t.detail.resource.id)});d(this,P,t=>{t.stopPropagation(),this.updatePrice(t),c(this,s,O).call(this,t),c(this,s,q).call(this,t),this.refs.quickAdd?.fetchProductPage(this.productPageUrl),t.target!==this.variantPicker&&this.variantPicker?.updateVariantPicker(t.detail.data.html),c(this,s,x).call(this),A(this,u,null),this.removeAttribute("data-no-swatch-selected"),c(this,s,T).call(this)});d(this,u,null);d(this,b,t=>{t.detail.userInitiated&&A(this,u,t.detail.index)});d(this,k,()=>{const{slideshow:t}=this.refs;if(!t)return;if(this.variantPicker?.selectedOption){const o=this.variantPicker.selectedOption.dataset.optionMediaId;if(o){t.select({id:o},void 0,{animate:!1});return}}const e=t.initialSlide,a=e?.getAttribute("slide-id");if(e&&t.slides?.includes(e)&&a){t.select({id:a},void 0,{animate:!1});return}t.previous(void 0,{animate:!1})});v(this,"navigateToProduct",t=>{if(!(t.target instanceof Element)||this.hasAttribute("data-no-navigation")||t.target.closest('button, input, label, select, [tabindex="1"]'))return;const a=this.refs.productCardLink;if(!a.href)return;const o=new URL(a.href),l=a.getAttribute("id");if(!l)return;const h=this.closest('results-list[infinite-scroll="true"]');if(!window.Shopify.designMode&&h){const m=new URL(window.location.href),C=this.closest("li");m.hash=l,C&&C.dataset.page&&m.searchParams.set("page",C.dataset.page),Q(()=>{history.replaceState({},"",m.toString())})}t.target.closest("a")||n(this,w).call(this,t,o)});v(this,"resetVariant",z(n(this,k),100))}get productPageUrl(){return this.refs.productCardLink.href}getSelectedVariantId(){return this.querySelector('input[type="radio"]:checked[data-variant-id]')?.dataset.variantId||null}getProductCardLink(){return this.refs.productCardLink||null}connectedCallback(){if(super.connectedCallback(),!(this.refs.productCardLink instanceof HTMLAnchorElement))throw new Error("Product card link not found");n(this,g).call(this),this.addEventListener(I.variantUpdate,n(this,P)),this.addEventListener(I.variantSelected,n(this,L)),this.addEventListener(G.eventName,n(this,b)),K.addEventListener("change",n(this,g)),this.addEventListener("click",this.navigateToProduct),setTimeout(()=>{this.refs.slideshow?.isNested&&c(this,s,y).call(this)})}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("click",this.navigateToProduct)}updatePrice(t){const e=this.querySelectorAll("product-price [ref='priceContainer']")[1],a=t.detail.data.html.querySelector("product-price [ref='priceContainer']");a&&e&&Y(e,a)}get allVariants(){return this.querySelectorAll("input[data-variant-id]")}get variantPicker(){return this.querySelector("swatches-variant-picker-component")}previewVariant(t){const{slideshow:e}=this.refs;e&&(this.resetVariant.cancel(),e.select({id:t},void 0,{animate:!1}))}previewImage(t){if(t.pointerType!=="mouse")return;const{slideshow:e}=this.refs;e&&(this.resetVariant.cancel(),n(this,u)!=null&&n(this,u)>0?e.select(n(this,u),void 0,{animate:!1}):(e.next(void 0,{animate:!1}),setTimeout(()=>c(this,s,y).call(this))))}resetImage(t){if(t.pointerType!=="mouse")return;const{slideshow:e}=this.refs;if(this.variantPicker)n(this,k).call(this);else{if(!e)return;e.previous(void 0,{animate:!1})}}}p=new WeakMap,w=new WeakMap,s=new WeakSet,y=function(){this.refs.slideshow?.slides?.[this.refs.slideshow?.current]?.nextElementSibling?.querySelector('img[loading="lazy"]')?.removeAttribute("loading")},g=new WeakMap,L=new WeakMap,P=new WeakMap,T=function(){const t=this.querySelector("swatches-variant-picker-component overflow-list"),e=!!t?.querySelector('[slot="overflow"]');!t||!e||requestAnimationFrame(()=>{t.dispatchEvent(new CustomEvent("reflow",{bubbles:!0,detail:{}}))})},q=function(t){const e=t.detail.data.html?.querySelector("product-card a"),a=t.detail.data.html?.querySelector("product-card-link")?.getAttribute("data-featured-media-url");if(a&&this.closest("product-card-link")&&this.closest("product-card-link")?.setAttribute("data-featured-media-url",a),e instanceof HTMLAnchorElement){if(e.getAttribute("href")?.trim()==="")return;const o=e.href,{productCardLink:l,productTitleLink:h,cardGalleryLink:f}=this.refs;l.href=o,f instanceof HTMLAnchorElement&&(f.href=o),h instanceof HTMLAnchorElement&&(h.href=o)}},O=function(t){const e=t.detail.data.html.querySelectorAll("input:checked");for(const a of e)c(this,s,M).call(this,a.dataset.optionAvailable==="true")},M=function(t){const e=this.querySelector(".add-to-cart__button button");e instanceof HTMLButtonElement&&(e.disabled=!t)},x=function(){const{slideshow:t}=this.refs;if(!this.variantPicker?.selectedOption)return;const e=this.variantPicker?.selectedOption.dataset.optionMediaId;if(t&&e){const{slides:a=[]}=t.refs;for(const o of a)o.getAttribute("variant-image")!=null&&(o.hidden=o.getAttribute("slide-id")!==e);t.select({id:e},void 0,{animate:!1})}},u=new WeakMap,b=new WeakMap,k=new WeakMap;customElements.get("product-card")||customElements.define("product-card",V);var S,H;class j extends _{constructor(){super(...arguments);d(this,S)}connectedCallback(){super.connectedCallback(),this.parentProductCard=this.closest("product-card"),this.addEventListener(I.variantUpdate,c(this,S,H).bind(this))}variantChanged(t){if(!(t.target instanceof HTMLElement))return;const e=t.target instanceof HTMLInputElement&&t.target.name?.includes("-swatch"),a=t.target,o=parseInt(a.dataset.availableCount||"0"),l=a.dataset.firstAvailableOrFirstVariantId;if(e&&o>0&&l){t.stopPropagation(),this.updateSelectedOption(a);const h=this.dataset.productUrl?.split("?")[0];if(!h)return;const f=new URL(h,window.location.origin);f.searchParams.set("variant",l),f.searchParams.set("section_id","section-rendering-product-card");const m=f.href;this.pendingVariantId=l,this.fetchUpdatedSection(m);return}super.variantChanged(t)}showAllSwatches(t){t?.preventDefault();const{overflowList:e}=this.refs;e instanceof N&&e.showAll()}}S=new WeakSet,H=function(){if(this.pendingVariantId&&this.parentProductCard instanceof V){const t=new URL(this.parentProductCard.refs.productCardLink.href);t.searchParams.set("variant",this.pendingVariantId),this.parentProductCard.refs.productCardLink.href=t.toString(),this.pendingVariantId=null}};customElements.get("swatches-variant-picker-component")||customElements.define("swatches-variant-picker-component",j);
