var V=r=>{throw TypeError(r)};var q=(r,d,s)=>d.has(r)||V("Cannot "+s);var t=(r,d,s)=>(q(r,d,"read from private field"),s?s.call(r):d.get(r)),l=(r,d,s)=>d.has(r)?V("Cannot add the same private member more than once"):d instanceof WeakSet?d.add(r):d.set(r,s),e=(r,d,s,h)=>(q(r,d,"write to private field"),h?h.call(r,s):d.set(r,s),s),m=(r,d,s)=>(q(r,d,"access private method"),s);import{i as tt,k as st,c as W}from"./utilities.js";import"./zoom-dialog.js";import"./component.js";import"./scrolling.js";import"./events.js";import"./dialog.js";const z=1,U=5,A=1.5,mt=300,ut=50,yt=10;var O,o,b,P,a,x,w,g,C,f,E,p,T,S,n,Z,it,et,$,_,H,I,nt,N,j,ht,v,ot,at,B,rt,D,J,X,ct;class gt extends HTMLElement{constructor(){super(...arguments);l(this,n);l(this,O,new AbortController);l(this,o,A);l(this,b,0);l(this,P,A);l(this,a,{x:0,y:0});l(this,x,{x:0,y:0});l(this,w,{x:0,y:0});l(this,g,!1);l(this,C,!1);l(this,f,null);l(this,E,0);l(this,p,null);l(this,T,!1);l(this,S,!1);l(this,_,()=>{!t(this,C)&&tt()&&m(this,n,$).call(this),t(this,C)&&t(this,D).call(this)});l(this,H,new ResizeObserver(t(this,_)));l(this,I,s=>{st(s);const h=s.touches.length;if(h===2){const i=s.touches[0],c=s.touches[1];if(!i||!c)return;m(this,n,nt).call(this,i,c)}else if(h===1){const i=s.touches[0];if(!i)return;const c=performance.now();if(c-t(this,E)>=mt){m(this,n,j).call(this,c,i),m(this,n,N).call(this,i);return}if(t(this,p)&&R(i,t(this,p))<ut){m(this,n,ht).call(this,i),e(this,E,0),e(this,p,null);return}m(this,n,j).call(this,c,i),m(this,n,N).call(this,i)}});l(this,v,s=>{st(s);const h=s.touches.length;if(h===2){const i=s.touches[0],c=s.touches[1];i&&c&&m(this,n,ot).call(this,i,c)}else if(h===1&&t(this,g)){const i=s.touches[0];i&&m(this,n,at).call(this,i)}});l(this,B,s=>{s.touches.length===0&&(e(this,g,!1),t(this,D).call(this),e(this,T,!1))});l(this,D,()=>{t(this,f)||e(this,f,requestAnimationFrame(t(this,X)))});l(this,X,()=>{e(this,f,null),m(this,n,rt).call(this),this.style.setProperty("--drag-zoom-scale",t(this,o).toString()),this.style.setProperty("--drag-zoom-translate-x",`${t(this,a).x}px`),this.style.setProperty("--drag-zoom-translate-y",`${t(this,a).y}px`)})}connectedCallback(){t(this,n,Z)&&(m(this,n,it).call(this),m(this,n,et).call(this),tt()&&(m(this,n,$).call(this),t(this,X).call(this)))}disconnectedCallback(){t(this,O).abort(),t(this,H).disconnect(),m(this,n,J).call(this)}destroy(){t(this,O).abort(),m(this,n,J).call(this)}}O=new WeakMap,o=new WeakMap,b=new WeakMap,P=new WeakMap,a=new WeakMap,x=new WeakMap,w=new WeakMap,g=new WeakMap,C=new WeakMap,f=new WeakMap,E=new WeakMap,p=new WeakMap,T=new WeakMap,S=new WeakMap,n=new WeakSet,Z=function(){return this.querySelector("img")},it=function(){t(this,H).observe(this)},et=function(){const s=this.closest("zoom-dialog");if(!s||typeof s.close!="function")return;const h=s.close.bind(s);s.close=async(...i)=>(m(this,n,ct).call(this),await h(...i))},$=function(){if(t(this,C))return;e(this,C,!0);const{signal:s}=t(this,O),h={passive:!1,signal:s};this.addEventListener("touchstart",t(this,I),h),this.addEventListener("touchmove",t(this,v),h),this.addEventListener("touchend",t(this,B),h),t(this,X).call(this)},_=new WeakMap,H=new WeakMap,I=new WeakMap,nt=function(s,h){e(this,b,R(s,h)),e(this,P,t(this,o)),e(this,g,!1)},N=function(s){e(this,x,{x:s.clientX,y:s.clientY}),e(this,w,{x:t(this,a).x,y:t(this,a).y}),e(this,g,!0),e(this,T,!1)},j=function(s,h){e(this,E,s),e(this,p,{x:h.clientX,y:h.clientY})},ht=function(s){const h={x:this.clientWidth/2,y:this.clientHeight/2};let i;if(t(this,S)?(i=z,e(this,S,!1),e(this,a,{x:0,y:0})):Math.abs(t(this,o)-z)<.05?i=A:i=z,i!==z){const c=t(this,o);e(this,o,Math.min(U,i));const u={x:s.clientX-h.x,y:s.clientY-h.y},y=t(this,o)/c-1;t(this,a).x-=u.x*y/t(this,o),t(this,a).y-=u.y*y/t(this,o)}else e(this,o,i),e(this,a,{x:0,y:0});t(this,D).call(this)},v=new WeakMap,ot=function(s,h){const i=(s.clientX+h.clientX)/2,c=(s.clientY+h.clientY)/2,u=R(s,h),y=t(this,o),Y=u/t(this,b)*t(this,P);e(this,o,W(Y,z,U)),e(this,S,!0);const G=this.clientWidth/2,L=this.clientHeight/2,M=i-G,k=c-L,F=t(this,o)/y-1;t(this,a).x-=M*F/t(this,o),t(this,a).y-=k*F/t(this,o),t(this,D).call(this),e(this,g,!1)},at=function(s){const h=R(s,t(this,x));if(!t(this,T)&&h<yt)return;e(this,T,!0);const i=s.clientX-t(this,x).x,c=s.clientY-t(this,x).y;t(this,a).x=t(this,w).x+i/t(this,o),t(this,a).y=t(this,w).y+c/t(this,o),t(this,D).call(this)},B=new WeakMap,rt=function(){const s=this.clientWidth,h=this.clientHeight;if(!s||!h||!t(this,n,Z))return;if(e(this,o,W(t(this,o),z,U)),t(this,o)<=z){t(this,a).x=0,t(this,a).y=0;return}const i=this.getBoundingClientRect(),c=t(this,n,Z);let u,y;c.naturalWidth>0&&c.naturalHeight>0?(u=c.naturalWidth,y=c.naturalHeight):(u=i.width,y=i.width);const Y=u/y,G=i.width/i.height;let L,M;Y>G?(L=i.width,M=L/Y):(M=i.height,L=M*Y);const k=L*t(this,o),F=M*t(this,o),lt=Math.max(0,k-i.width),dt=Math.max(0,F-i.height),K=lt/2/t(this,o),Q=dt/2/t(this,o);t(this,a).x=W(t(this,a).x,-K,K),t(this,a).y=W(t(this,a).y,-Q,Q),this.style.setProperty("--drag-zoom-scale",t(this,o).toString()),this.style.setProperty("--drag-zoom-translate-x",`${t(this,a).x}px`),this.style.setProperty("--drag-zoom-translate-y",`${t(this,a).y}px`)},D=new WeakMap,J=function(){t(this,f)&&(cancelAnimationFrame(t(this,f)),e(this,f,null))},X=new WeakMap,ct=function(){e(this,o,A),e(this,P,A),t(this,a).x=0,t(this,a).y=0,e(this,x,{x:0,y:0}),e(this,w,{x:0,y:0}),e(this,g,!1),e(this,E,0),e(this,p,null),e(this,T,!1),this.style.setProperty("--drag-zoom-scale",A.toString()),this.style.setProperty("--drag-zoom-translate-x","0px"),this.style.setProperty("--drag-zoom-translate-y","0px")};function R(r,d){const s=r.x??r.clientX,h=r.y??r.clientY,i=d.x??d.clientX,c=d.y??d.clientY,u=s-i,y=h-c;return Math.sqrt(u*u+y*y)}customElements.get("drag-zoom-wrapper")||customElements.define("drag-zoom-wrapper",gt);
