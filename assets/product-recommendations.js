var L=e=>{throw TypeError(e)};var w=(e,r,t)=>r.has(e)||L("Cannot "+t);var o=(e,r,t)=>(w(e,r,"read from private field"),t?t.call(e):r.get(e)),d=(e,r,t)=>r.has(e)?L("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(e):r.set(e,t),E=(e,r,t,n)=>(w(e,r,"write to private field"),n?n.call(e,t):r.set(e,t),t),a=(e,r,t)=>(w(e,r,"access private method"),t);var b,p,l,c,s,M,x,f;class y extends HTMLElement{constructor(){super(...arguments);d(this,s);d(this,b,new IntersectionObserver((t,n)=>{t[0]?.isIntersecting&&(n.disconnect(),a(this,s,M).call(this))},{rootMargin:"0px 0px 400px 0px"}));d(this,p,new MutationObserver(t=>{for(const n of t)if(!(n.target!==this||n.type!=="attributes")&&n.attributeName!=="data-error"&&!(n.attributeName==="class"&&this.classList.contains("hidden"))&&!(n.attributeName==="data-recommendations-performed"&&this.dataset.recommendationsPerformed==="true")){a(this,s,M).call(this);break}}));d(this,l,{});d(this,c,null)}connectedCallback(){o(this,b).observe(this),o(this,p).observe(this,{attributes:!0})}}b=new WeakMap,p=new WeakMap,l=new WeakMap,c=new WeakMap,s=new WeakSet,M=function(){const{productId:t,recommendationsPerformed:n,sectionId:g,intent:m}=this.dataset,u=this.id;if(!t||!u)throw new Error("Product ID and an ID attribute are required");n!=="true"&&a(this,s,x).call(this,t,g,m).then(i=>{if(!i.success){Shopify.designMode||a(this,s,f).call(this,new Error(`Server returned ${i.status}`));return}const h=document.createElement("div");h.innerHTML=i.data||"";const v=h.querySelector(`product-recommendations[id="${u}"]`);v?.innerHTML&&v.innerHTML.trim().length?(this.dataset.recommendationsPerformed="true",this.innerHTML=v.innerHTML):a(this,s,f).call(this,new Error("No recommendations available"))}).catch(i=>{a(this,s,f).call(this,i)})},x=async function(t,n,g){const m=`${this.dataset.url}&product_id=${t}&section_id=${n}&intent=${g}`,u=o(this,l)[m];if(u)return{success:!0,data:u};o(this,c)?.abort(),E(this,c,new AbortController);try{const i=await fetch(m,{signal:o(this,c).signal});if(!i.ok)return{success:!1,status:i.status};const h=await i.text();return o(this,l)[m]=h,{success:!0,data:h}}finally{E(this,c,null)}},f=function(t){console.error("Product recommendations error:",t.message),this.classList.add("hidden"),this.dataset.error="Error loading product recommendations"};customElements.get("product-recommendations")||customElements.define("product-recommendations",y);
