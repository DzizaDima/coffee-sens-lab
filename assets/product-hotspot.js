var _=Object.defineProperty;var B=i=>{throw TypeError(i)};var $=(i,s,e)=>s in i?_(i,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[s]=e;var d=(i,s,e)=>$(i,typeof s!="symbol"?s+"":s,e),w=(i,s,e)=>s.has(i)||B("Cannot "+e);var r=(i,s,e)=>(w(i,s,"read from private field"),e?e.call(i):s.get(i)),b=(i,s,e)=>s.has(i)?B("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(i):s.set(i,e),P=(i,s,e,t)=>(w(i,s,"write to private field"),t?t.call(i,e):s.set(i,e),e),u=(i,s,e)=>(w(i,s,"access private method"),e);import{C as Q}from"./component.js";import"./quick-add.js";import{m as M,i as H,t as Y}from"./utilities.js";import"./morph.js";import"./events.js";import"./dialog.js";var m,l,G,K,A,f,O,h;class I extends Q{constructor(){super(...arguments);b(this,l);d(this,"requiredRefs",["trigger","dialog"]);b(this,m,null);d(this,"timer",null);b(this,f,()=>{u(this,l,A).call(this),H()||u(this,l,K).call(this)});b(this,h,e=>{const{dialog:t,trigger:a}=this.refs;if(this.timer&&(clearTimeout(this.timer),this.timer=null),!t.open)return;const g=e.target===a,o=e.target===t,k=e.relatedTarget===t||e.relatedTarget instanceof Element&&e.relatedTarget.closest("dialog")===t,n=e.relatedTarget===a;(g&&!k||o&&!n)&&this.closeDialog()});d(this,"handleHotspotClick",e=>{const t=matchMedia("(hover: none)").matches;H()||t?(e.preventDefault(),e.stopPropagation(),u(this,l,G).call(this)):this.showDialog()});d(this,"showDialog",async()=>{const{dialog:e}=this.refs;await u(this,l,O).call(this),e.dataset.showing="true",e.show(),document.body.addEventListener("click",this.lightDismissMouse),document.body.addEventListener("keydown",this.lightDismissKeyboard),document.body.addEventListener("keyup",this.lightDismissKeyboard),e.addEventListener("pointerleave",r(this,h))});d(this,"closeDialog",async()=>{const{dialog:e,trigger:t}=this.refs;e.dataset.closing="true",e.close(),document.body.removeEventListener("click",this.lightDismissMouse),document.body.removeEventListener("keydown",this.lightDismissKeyboard),document.body.removeEventListener("keyup",this.lightDismissKeyboard),e.removeEventListener("pointerleave",r(this,h)),t.removeEventListener("pointerleave",r(this,h));const a=e.getAnimations({subtree:!0});await Promise.allSettled(a.map(g=>g.finished)),e.open||(delete e.dataset.showing,delete e.dataset.closing,delete e.dataset.placement)});d(this,"lightDismissMouse",e=>{const{dialog:t}=this.refs;Y(e,t)&&this.closeDialog()});d(this,"lightDismissKeyboard",e=>{const{dialog:t}=this.refs;(e.type==="keydown"&&e.key==="Escape"||e.type==="keyup"&&!t.matches(":is(:focus, :focus-visible, :focus-within)"))&&this.closeDialog()})}connectedCallback(){super.connectedCallback(),r(this,f).call(this),M.addEventListener("change",r(this,f))}disconnectedCallback(){super.disconnectedCallback(),u(this,l,A).call(this),M.removeEventListener("change",r(this,f))}getHotspotProductLink(){return this.refs.productLink||null}}m=new WeakMap,l=new WeakSet,G=function(){const e=this.querySelector("quick-add-component");e&&e.handleClick(new MouseEvent("click",{bubbles:!0,cancelable:!0}))},K=function(){const{trigger:e,dialog:t}=this.refs,a=()=>{t.open||(this.timer=setTimeout(()=>{this.showDialog()},120),e.addEventListener("pointerleave",r(this,h)))};P(this,m,a),e.addEventListener("pointerenter",a)},A=function(){const{trigger:e}=this.refs;r(this,m)&&(e.removeEventListener("pointerenter",r(this,m)),e.removeEventListener("pointerleave",r(this,h)),P(this,m,null)),this.timer&&(clearTimeout(this.timer),this.timer=null)},f=new WeakMap,O=function(){const{trigger:e,dialog:t}=this.refs,a=this.parentElement;if(!a)return;const g=10,o=10,k=g+o,n=a?.getBoundingClientRect(),L=e.getBoundingClientRect();t.style.visibility="hidden",t.style.display="block",t.style.transform="none",t.removeAttribute("data-placement");const{width:R,height:D}=t.getBoundingClientRect();t.style.removeProperty("display"),t.style.removeProperty("visibility"),t.style.removeProperty("transform");const q=L.left-n.left,x=L.right-n.left,E=L.top-n.top,C=L.bottom-n.top,N=n.width-x-o,S=q-o;let v="right";N>=R+g?v="right":S>=R+g?v="left":v="center";let p="bottom",y=0;if(v!=="center"){let c=E,T=E+D;T>n.height-o?(c=C-D,T=C,p="top",c<o?y=o-c:T>n.height-o&&(y=-(T-(n.height-o)))):c<o&&(c<o&&(y=o-c),p="bottom")}else n.height-C>=D+k?p="bottom":E>=D+k?p="top":p=E<n.height/2?"bottom":"top";return t.dataset.placement=`${v},${p}`,y!==0?t.style.setProperty("--dialog-vertical-offset",`${y}px`):t.style.removeProperty("--dialog-vertical-offset"),new Promise(c=>setTimeout(c,100))},h=new WeakMap;customElements.define("product-hotspot-component",I);
