var L=Object.defineProperty;var y=s=>{throw TypeError(s)};var V=(s,i,e)=>i in s?L(s,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[i]=e;var g=(s,i,e)=>V(s,typeof i!="symbol"?i+"":i,e),p=(s,i,e)=>i.has(s)||y("Cannot "+e);var b=(s,i,e)=>(p(s,i,"read from private field"),e?e.call(s):i.get(s)),w=(s,i,e)=>i.has(s)?y("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(s):i.set(s,e);var d=(s,i,e)=>(p(s,i,"access private method"),e);import{C as S}from"./component.js";import{w as E,x as I,s as T,y as k,d as C,o as M,p as R}from"./utilities.js";import{s as _}from"./scrolling.js";import{Z as A}from"./events.js";import{a as N}from"./dialog.js";var h,m,u;class q extends S{constructor(){super(...arguments);w(this,m);g(this,"requiredRefs",["dialog","media","thumbnails"]);w(this,h,new Set);g(this,"handleScroll",C(async()=>{const{media:e,thumbnails:t}=this.refs,a=await P(e),o=e.indexOf(a),n=t.children[o];!n||!(n instanceof HTMLElement)||(Array.from(t.querySelectorAll("button")).forEach((r,c)=>{r.setAttribute("aria-selected",`${c===o}`)}),d(this,m,u).call(this,a),this.dispatchEvent(new A(o)))},50))}connectedCallback(){super.connectedCallback(),this.refs.dialog.addEventListener("scroll",this.handleScroll)}disconnectedCallback(){super.disconnectedCallback(),this.refs.dialog.removeEventListener("scroll",this.handleScroll)}async open(e,t){t.preventDefault();const{dialog:a,media:o,thumbnails:n}=this.refs,r=o[e],c=n.children[e],l=()=>{a.showModal();for(const D of[c,r])D?.scrollIntoView({behavior:"instant"})},f=t.target instanceof Element?t.target.closest("li,slideshow-slide"):null;if(!E()||I()||!f||!r)return l();const v="gallery-item";f.style.setProperty("view-transition-name",v),await T(()=>{l(),f.style.removeProperty("view-transition-name"),r.style.setProperty("view-transition-name",v)}),r.style.removeProperty("view-transition-name"),this.selectThumbnail(e,{behavior:"instant"})}async close(){const{dialog:e,media:t}=this.refs;if(!E()||I())return this.closeDialog();const a=await P(t),o=t.indexOf(a),n="gallery-item",r=this.closest("media-gallery"),l=r?.presentation==="carousel"?r.slideshow?.slides?.[o]:r?.media?.[o];if(!l)return this.closeDialog();e.classList.add("dialog--closed"),await M(this.refs.thumbnails),a.style.setProperty("view-transition-name",n),await T(()=>{a.style.removeProperty("view-transition-name"),l.style.setProperty("view-transition-name",n),this.closeDialog()}),l.style.removeProperty("view-transition-name"),e.classList.remove("dialog--closed")}closeDialog(){const{dialog:e}=this.refs;e.close(),window.dispatchEvent(new N)}handleKeyDown(e){e.key==="Escape"&&(e.preventDefault(),this.close())}async handleThumbnailClick(e){const t=R()?"instant":"smooth";this.selectThumbnail(e,{behavior:t})}async handleThumbnailPointerEnter(e){const{media:t}=this.refs;t[e]&&d(this,m,u).call(this,t[e])}async selectThumbnail(e,t={behavior:"smooth"}){if(!this.refs.thumbnails||!this.refs.thumbnails.children.length||isNaN(e)||e<0||e>=this.refs.thumbnails.children.length)return;const{media:a,thumbnails:o}=this.refs,n=o.children[e];if(!n||!(n instanceof HTMLElement))return;Array.from(o.querySelectorAll("button")).forEach((c,l)=>{c.setAttribute("aria-selected",`${l===e}`)}),_(n,{ancestor:o,behavior:t.behavior,block:"center",inline:"center"});const r=a[e];r&&(r.scrollIntoView({behavior:t.behavior}),d(this,m,u).call(this,r)),this.dispatchEvent(new A(e))}}h=new WeakMap,m=new WeakSet,u=function(e){if(!e.classList.contains("product-media-container--image"))return!1;const t=e.querySelector("img.product-media__image");if(!t||!(t instanceof HTMLImageElement))return!1;const a=t.getAttribute("data_max_resolution");if(!a||b(this,h).has(a))return!1;k(a);const o=new Image;o.className=t.className,o.alt=t.alt,o.setAttribute("data_max_resolution",a),o.onload=()=>{t.replaceWith(o),b(this,h).add(a)},o.src=a};customElements.get("zoom-dialog")||customElements.define("zoom-dialog",q);function P(s){return new Promise(i=>{const e=new IntersectionObserver(t=>{const a=t.reduce((o,n)=>n.intersectionRatio>o.intersectionRatio?n:o);e.disconnect(),i(a.target)},{threshold:Array.from({length:100},(t,a)=>a/100)});for(const t of s)e.observe(t)})}
