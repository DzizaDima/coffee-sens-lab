var X=Object.defineProperty;var Y=o=>{throw TypeError(o)};var Z=(o,r,t)=>r in o?X(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t;var B=(o,r,t)=>Z(o,typeof r!="symbol"?r+"":r,t),F=(o,r,t)=>r.has(o)||Y("Cannot "+t);var d=(o,r,t)=>(F(o,r,"read from private field"),t?t.call(o):r.get(o)),p=(o,r,t)=>r.has(o)?Y("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(o):r.set(o,t),I=(o,r,t,e)=>(F(o,r,"write to private field"),e?e.call(o,t):r.set(o,t),t),c=(o,r,t)=>(F(o,r,"access private method"),t);import{C as H}from"./component.js";import{y as tt,o as et,f as at}from"./utilities.js";import{T as D,d as ot,C as $}from"./events.js";import{c as rt}from"./performance.js";import{m as Q}from"./morph.js";const G=1e4,it=1e3,nt=5e3;var m,A,R,W;class st extends H{constructor(){super(...arguments);p(this,R);B(this,"requiredRefs",["addToCartButton"]);p(this,m,[]);p(this,A,()=>{const t=this.dataset.productVariantMedia;t&&tt(t)});B(this,"animateAddToCart",async function(){const{addToCartButton:t}=this.refs;d(this,m)||I(this,m,[]),d(this,m).forEach(a=>clearTimeout(a)),I(this,m,[]),t.dataset.added!=="true"&&(t.dataset.added="true"),await et(t);const e=setTimeout(()=>{t.removeAttribute("data-added");const a=d(this,m).indexOf(e);a>-1&&d(this,m).splice(a,1)},800);d(this,m).push(e)})}connectedCallback(){super.connectedCallback(),this.addEventListener("pointerenter",d(this,A))}disconnectedCallback(){super.disconnectedCallback(),d(this,m)&&d(this,m).forEach(t=>clearTimeout(t)),this.removeEventListener("pointerenter",d(this,A))}disable(){this.refs.addToCartButton.disabled=!0}enable(){this.refs.addToCartButton.disabled=!1}handleClick(t){if(!this.closest("form")?.checkValidity())return;const s=this.closest("product-form-component")?.refs.quantitySelector;s?.canAddToCart&&!s.canAddToCart().canAdd||this.refs.addToCartButton.dataset.puppet!=="true"&&(this.dataset.addToCartAnimation==="true"&&!t.target.closest(".quick-add-modal")&&c(this,R,W).call(this),this.animateAddToCart())}}m=new WeakMap,A=new WeakMap,R=new WeakSet,W=function(){const{addToCartButton:t}=this.refs,e=document.querySelector(".header-actions__cart-icon"),a=this.dataset.productVariantMedia;if(!e||!t||!a)return;const s=document.createElement("fly-to-cart");let u=t.classList.contains("quick-add__button")?"fly-to-cart--quick":"fly-to-cart--main";s.classList.add(u),s.style.setProperty("background-image",`url(${a})`),s.style.setProperty("--start-opacity","0"),s.source=t,s.destination=e,document.body.appendChild(s)};customElements.get("add-to-cart-component")||customElements.define("add-to-cart-component",st);var x,C,n,V,w,_,z,L,P,U,N,k;class dt extends H{constructor(){super(...arguments);p(this,n);B(this,"requiredRefs",["variantId","liveRegion"]);p(this,x,new AbortController);p(this,C);p(this,_,async t=>{if(t.detail?.sourceId===this.id||t.detail?.data?.source==="product-form-component")return;const e=t.detail?.resource;e?.items?c(this,n,V).call(this,e):await c(this,n,w).call(this)});p(this,N,async t=>{if(t.detail.data.newProduct)this.dataset.productId=t.detail.data.newProduct.id;else if(t.detail.data.productId!==this.dataset.productId)return;const{variantId:e}=this.refs;e.value=t.detail.resource?.id??"";const{addToCartButtonContainer:a,acceleratedCheckoutButtonContainer:s}=this.refs,u=a?.refs.addToCartButton;if(!a||!u&&!s)return;t.detail.resource==null||t.detail.resource.available==!1?a.disable():a.enable();const h=t.detail.data.html.querySelector('product-form-component [ref="addToCartButton"]');if(h&&u&&Q(u,h),s&&(t.detail.resource==null||t.detail.resource.available==!1?s?.setAttribute("hidden","true"):s?.removeAttribute("hidden")),t.detail.resource){const b=t.detail.resource.featured_media?.preview_image?.src;b&&this.refs.addToCartButtonContainer?.setAttribute("data-product-variant-media",b+"&width=100")}const{quantityRules:E,pricePerItem:g,quantitySelector:y,productFormButtons:i,quantityLabel:T,quantitySelectorWrapper:f}=this.refs,l=t.detail.data.html.querySelector('quantity-selector-component input[ref="quantityInput"]');y?.updateConstraints&&l&&y.updateConstraints(l.min,l.max||null,l.step);const q=t.detail.data.html.querySelector(".quantity-rules"),J=!!E!=!!q,M=t.detail.data.html.querySelector("price-per-item");if((J||!!g!=!!M)&&y){const b=y.getValue?.(),v=t.detail.data.html.querySelector(".product-form-buttons");if(i&&v){Q(i,v);const S=t.detail.data.html.querySelector('quantity-selector-component input[ref="quantityInput"]');this.refs.quantitySelector?.updateConstraints&&S&&b&&(this.refs.quantitySelector.setValue(b),this.refs.quantitySelector.updateConstraints(S.min,S.max||null,S.step))}}else{const b=[[".quantity-label",T,y],[".quantity-rules",E,this.refs.productFormButtons],["price-per-item",g,f]];for(const[v,S,K]of b)c(this,n,U).call(this,S,t.detail.data.html.querySelector(v),K)}const O=this.refs.volumePricing,j=t.detail.data.html.querySelector("volume-pricing");c(this,n,U).call(this,O,j,this.refs.productFormButtons),(E||q||g||M||O||j)&&await c(this,n,w).call(this)});p(this,k,()=>{this.refs.addToCartButtonContainer?.disable()})}connectedCallback(){super.connectedCallback();const{signal:t}=d(this,x),e=this.closest(".shopify-section, dialog, product-card");e?.addEventListener(D.variantUpdate,d(this,N),{signal:t}),e?.addEventListener(D.variantSelected,d(this,k),{signal:t}),document.addEventListener(D.cartUpdate,d(this,_),{signal:t})}disconnectedCallback(){super.disconnectedCallback(),d(this,x).abort()}handleSubmit(t){const{addToCartTextError:e}=this.refs;t.preventDefault(),d(this,C)&&clearTimeout(d(this,C));const a=this.querySelectorAll("add-to-cart-component");if(Array.from(a).some(i=>i.refs.addToCartButton?.disabled))return;const u=this.querySelector("form");if(!u)throw new Error("Product form element missing");if(this.refs.quantitySelector?.canAddToCart){const i=this.refs.quantitySelector.canAddToCart();if(!i.canAdd){for(const l of a)l.disable();const f=(this.dataset.quantityErrorMax||"").replace("{{ maximum }}",i.maxQuantity?.toString()||"");if(e){e.classList.remove("hidden");const l=e.childNodes[2];if(l)l.textContent=f;else{const q=document.createTextNode(f);e.appendChild(q)}c(this,n,L).call(this,f),d(this,C)&&clearTimeout(d(this,C)),I(this,C,setTimeout(()=>{e&&(e.classList.add("hidden"),c(this,n,P).call(this))},G))}setTimeout(()=>{for(const l of a)l.enable()},it);return}}const h=new FormData(u),E=document.querySelectorAll("cart-items-component");let g=[];E.forEach(i=>{i instanceof HTMLElement&&i.dataset.sectionId&&g.push(i.dataset.sectionId),h.append("sections",g.join(","))});const y=at("javascript",{body:h});fetch(Theme.routes.cart_add_url,{...y,headers:{...y.headers,Accept:"text/html"}}).then(i=>i.json()).then(async i=>{if(i.status){if(this.dispatchEvent(new ot(u.getAttribute("id")||"",i.message,i.description,i.errors)),!e)return;e.classList.remove("hidden");const T=e.childNodes[2];if(T)T.textContent=i.message;else{const f=document.createTextNode(i.message);e.appendChild(f)}c(this,n,L).call(this,i.message),I(this,C,setTimeout(()=>{e&&(e.classList.add("hidden"),c(this,n,P).call(this))},G)),this.dispatchEvent(new $({},this.id,{didError:!0,source:"product-form-component",itemCount:Number(h.get("quantity"))||Number(this.dataset.quantityDefault),productId:this.dataset.productId}));return}else{const T=h.get("id");if(e&&(e.classList.add("hidden"),e.removeAttribute("aria-live")),!T)throw new Error("Form ID is required");const f=a[0]?.refs.addToCartButton;if(f){const q=f.querySelector(".add-to-cart-text--added")?.textContent?.trim()||Theme.translations.added;c(this,n,L).call(this,q),setTimeout(()=>{c(this,n,P).call(this)},nt)}await c(this,n,w).call(this),this.dispatchEvent(new $({},T.toString(),{source:"product-form-component",itemCount:Number(h.get("quantity"))||Number(this.dataset.quantityDefault),productId:this.dataset.productId,sections:i.sections}))}}).catch(i=>{console.error(i)}).finally(()=>{rt.measureFromEvent("add:user-action",t)})}}x=new WeakMap,C=new WeakMap,n=new WeakSet,V=function(t){const e=this.querySelector('input[name="id"]');if(!e?.value||!t?.items)return 0;const a=t.items.find(h=>h.variant_id.toString()===e.value.toString()),s=a?a.quantity:0,u=this.querySelector("quantity-selector-component");return u?.setCartQuantity&&u.setCartQuantity(s),c(this,n,z).call(this,s),s},w=async function(){if(!this.querySelector('input[name="id"]')?.value)return 0;try{const a=await(await fetch("/cart.js")).json();return c(this,n,V).call(this,a)}catch(e){return console.error("Failed to fetch cart quantity:",e),0}},_=new WeakMap,z=function(t){const e=this.refs.quantityLabelCartCount;if(e){const a=e.textContent?.match(/\((\d+)\s+(.+)\)/);a&&a[2]&&(e.textContent=`(${t} ${a[2]})`),e.classList.toggle("hidden",t===0)}},L=function(t){const e=this.refs.liveRegion;e.textContent=t},P=function(){const t=this.refs.liveRegion;t.textContent=""},U=function(t,e,a=null){t&&e?Q(t,e):t&&!e?t.remove():!t&&e&&a&&a.insertAdjacentElement("beforebegin",e.cloneNode(!0))},N=new WeakMap,k=new WeakMap;customElements.get("product-form-component")||customElements.define("product-form-component",dt);
