var d=Object.defineProperty;var h=(l,u,t)=>u in l?d(l,u,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[u]=t;var f=(l,u,t)=>h(l,typeof u!="symbol"?u+"":u,t);import{C as m}from"./component.js";import{Q as y}from"./events.js";import{j as r}from"./utilities.js";class v extends m{constructor(){super(...arguments);f(this,"requiredRefs",["quantityInput","minusButton","plusButton"]);f(this,"serverDisabledMinus",!1);f(this,"serverDisabledPlus",!1);f(this,"initialized",!1)}connectedCallback(){super.connectedCallback();const{minusButton:t,plusButton:e}=this.refs;t.disabled&&(this.serverDisabledMinus=!0),e.disabled&&(this.serverDisabledPlus=!0),this.initialized=!0,this.updateButtonStates()}disconnectedCallback(){super.disconnectedCallback()}setCartQuantity(t){this.refs.quantityInput.setAttribute("data-cart-quantity",t.toString()),this.updateCartQuantity()}canAddToCart(){const{max:t,cartQuantity:e,value:a}=this.getCurrentValues(),n=a;return{canAdd:!(t!==null&&e+n>t),maxQuantity:t,cartQuantity:e,quantityToAdd:n}}getValue(){return this.refs.quantityInput.value}setValue(t){this.refs.quantityInput.value=t}updateConstraints(t,e,a){const{quantityInput:n}=this.refs,i=parseInt(n.value)||0;n.min=t,e?n.max=e:n.removeAttribute("max"),n.step=a;const s=r(t,1),o=r(a,1),p=this.getEffectiveMax();let c=i;(i-s)%o!==0&&(c=s+Math.floor((i-s)/o)*o),c=Math.max(s,Math.min(p??1/0,c)),c!==i&&(n.value=c.toString()),this.updateButtonStates()}getCurrentValues(){const{quantityInput:t}=this.refs;return{min:r(t.min,1),max:r(t.max,null),step:r(t.step,1),value:r(t.value,0),cartQuantity:r(t.getAttribute("data-cart-quantity"),0)}}getEffectiveMax(){const{max:t,cartQuantity:e,min:a}=this.getCurrentValues();return t===null?null:Math.max(t-e,a)}updateButtonStates(){const{minusButton:t,plusButton:e}=this.refs,{min:a,value:n}=this.getCurrentValues(),i=this.getEffectiveMax();this.serverDisabledMinus||(t.disabled=n<=a),this.serverDisabledPlus||(e.disabled=i!==null&&n>=i)}updateQuantity(t){const{quantityInput:e}=this.refs,{min:a,step:n,value:i}=this.getCurrentValues(),s=this.getEffectiveMax(),o=Math.min(s??1/0,Math.max(a,i+n*t));e.value=o.toString(),this.onQuantityChange(),this.updateButtonStates()}increaseQuantity(t){t.target instanceof HTMLElement&&(t.preventDefault(),this.updateQuantity(1))}decreaseQuantity(t){t.target instanceof HTMLElement&&(t.preventDefault(),this.updateQuantity(-1))}selectInputValue(t){const{quantityInput:e}=this.refs;!(t.target instanceof HTMLInputElement)||document.activeElement!==e||e.select()}setQuantity(t){if(!(t.target instanceof HTMLInputElement))return;t.preventDefault();const{quantityInput:e}=this.refs,{min:a,step:n}=this.getCurrentValues(),i=this.getEffectiveMax(),s=Math.min(i??1/0,Math.max(a,parseInt(t.target.value)||0));if((s-a)%n!==0){e.value=s.toString(),e.reportValidity();return}e.value=s.toString(),this.onQuantityChange(),this.updateButtonStates()}onQuantityChange(){const{quantityInput:t}=this.refs,e=parseInt(t.value);this.dispatchEvent(new y(e,Number(t.dataset.cartLine)||void 0))}updateCartQuantity(){const{quantityInput:t}=this.refs,{min:e,value:a}=this.getCurrentValues(),n=this.getEffectiveMax(),i=Math.min(n??1/0,Math.max(e,a));i!==a&&(t.value=i.toString()),this.updateButtonStates()}get quantityInput(){if(!this.refs.quantityInput)throw new Error('Missing <input ref="quantityInput" /> inside <quantity-selector-component />');return this.refs.quantityInput}}customElements.get("quantity-selector-component")||customElements.define("quantity-selector-component",v);export{v as Q};
