var v=Object.defineProperty;var y=t=>{throw TypeError(t)};var P=(t,i,e)=>i in t?v(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var p=(t,i,e)=>P(t,typeof i!="symbol"?i+"":i,e),M=(t,i,e)=>i.has(t)||y("Cannot "+e);var d=(t,i,e)=>(M(t,i,"read from private field"),e?e.call(t):i.get(t)),c=(t,i,e)=>i.has(t)?y("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(t):i.set(t,e);var g=(t,i,e)=>(M(t,i,"access private method"),e);import{C}from"./component.js";import{T as S,b as E}from"./events.js";import{a as V}from"./dialog.js";import"./utilities.js";var l;class w extends C{constructor(){super(...arguments);p(this,"isPlaying",!1);c(this,l,new AbortController);p(this,"showDeferredMedia",()=>{this.loadContent(!0),this.isPlaying=!0,this.updatePlayPauseHint(this.isPlaying)})}connectedCallback(){super.connectedCallback();const e=d(this,l).signal;document.addEventListener(S.mediaStartedPlaying,this.pauseMedia.bind(this),{signal:e}),window.addEventListener(V.eventName,this.pauseMedia.bind(this),{signal:e})}disconnectedCallback(){super.disconnectedCallback(),d(this,l).abort()}updatePlayPauseHint(e){const a=this.refs.toggleMediaButton;if(a instanceof HTMLElement){a.classList.remove("hidden");const s=a.querySelector(".icon-play");s&&s.classList.toggle("hidden",e);const n=a.querySelector(".icon-pause");n&&n.classList.toggle("hidden",!e)}}loadContent(e=!0){if(this.getAttribute("data-media-loaded"))return;this.dispatchEvent(new E(this));const a=this.querySelector("template")?.content.firstElementChild?.cloneNode(!0);a&&(this.setAttribute("data-media-loaded","true"),this.appendChild(a),e&&a instanceof HTMLElement&&a.focus(),this.refs.deferredMediaPlayButton?.classList.add("deferred-media__playing"),a instanceof HTMLVideoElement&&a.getAttribute("autoplay")&&a.play())}toggleMedia(){this.isPlaying?this.pauseMedia():this.playMedia()}playMedia(){const e=this.querySelector("iframe[data-video-type]");e?e.contentWindow?.postMessage(e.dataset.videoType==="youtube"?'{"event":"command","func":"playVideo","args":""}':'{"method":"play"}',"*"):this.querySelector("video")?.play(),this.isPlaying=!0,this.updatePlayPauseHint(this.isPlaying)}pauseMedia(){const e=this.querySelector("iframe[data-video-type]");e?e.contentWindow?.postMessage(e.dataset.videoType==="youtube"?'{"event":"command","func":"pauseVideo","args":""}':'{"method":"pause"}',"*"):this.querySelector("video")?.pause(),this.isPlaying=!1,this.getAttribute("data-media-loaded")&&this.updatePlayPauseHint(this.isPlaying)}}l=new WeakMap;customElements.get("deferred-media")||customElements.define("deferred-media",w);var r,u,b;class I extends w{constructor(){super(...arguments);c(this,u);c(this,r,new AbortController)}loadContent(){super.loadContent(),Shopify.loadFeatures([{name:"model-viewer-ui",version:"1.0",onLoad:this.setupModelViewerUI.bind(this)}])}disconnectedCallback(){super.disconnectedCallback(),d(this,r).abort()}pauseMedia(){super.pauseMedia(),this.modelViewerUI?.pause()}playMedia(){super.playMedia(),this.modelViewerUI?.play()}async setupModelViewerUI(e){if(e||(Shopify.ModelViewerUI||await g(this,u,b).call(this),!Shopify.ModelViewerUI))return;const a=this.querySelector("model-viewer");if(!a)return;const s=d(this,r).signal;if(this.modelViewerUI=new Shopify.ModelViewerUI(a),!this.modelViewerUI)return;this.playMedia();let n=0,h=0;a.addEventListener("pointerdown",o=>{n=o.clientX,h=o.clientY},{signal:s}),a.addEventListener("click",o=>{const m=Math.abs(o.clientX-n),f=Math.abs(o.clientY-h);Math.sqrt(m*m+f*f)<10&&this.pauseMedia()},{signal:s})}}r=new WeakMap,u=new WeakSet,b=async function(){for(let s=0;s<10;s++){if(Shopify.ModelViewerUI)return;await new Promise(n=>setTimeout(n,50))}};customElements.get("product-model")||customElements.define("product-model",I);
