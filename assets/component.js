var O=Object.defineProperty;var S=e=>{throw TypeError(e)};var T=(e,t,r)=>t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var R=(e,t,r)=>T(e,typeof t!="symbol"?t+"":t,r),x=(e,t,r)=>t.has(e)||S("Cannot "+r);var u=(e,t,r)=>(x(e,t,"read from private field"),r?r.call(e):t.get(e)),b=(e,t,r)=>t.has(e)?S("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r);var g=(e,t,r)=>(x(e,t,"access private method"),r);import{r as H}from"./utilities.js";class P extends HTMLElement{connectedCallback(){if(!this.shadowRoot){const t=this.querySelector(':scope > template[shadowrootmode="open"]');if(!(t instanceof HTMLTemplateElement))return;this.attachShadow({mode:"open"}).append(t.content.cloneNode(!0))}}}var l,y,f,d;class M extends P{constructor(){super(...arguments);b(this,l);R(this,"refs",{});R(this,"requiredRefs");b(this,f,new MutationObserver(r=>{r.some(o=>o.type==="attributes"&&u(this,d).call(this,o.target)||o.type==="childList"&&[...o.addedNodes,...o.removedNodes].some(u(this,d)))&&g(this,l,y).call(this)}));b(this,d,r=>E(D(r))===this)}get roots(){return this.shadowRoot?[this,this.shadowRoot]:[this]}connectedCallback(){super.connectedCallback(),W(),g(this,l,y).call(this),H(()=>{for(const r of this.roots)u(this,f).observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["ref"],attributeOldValue:!0})})}updatedCallback(){u(this,f).takeRecords(),g(this,l,y).call(this)}disconnectedCallback(){u(this,f).disconnect()}}l=new WeakSet,y=function(){const r={},o=this.roots.reduce((n,s)=>{for(const a of s.querySelectorAll("[ref]"))u(this,d).call(this,a)&&n.add(a);return n},new Set);for(const n of o){const s=n.getAttribute("ref")??"",a=s.endsWith("[]"),i=a?s.slice(0,-2):s;if(a){const h=Array.isArray(r[i])?r[i]:[];h.push(n),r[i]=h}else r[i]=n}if(this.requiredRefs?.length){for(const n of this.requiredRefs)if(!(n in r))throw new j(n,this)}this.refs=r},f=new WeakMap,d=new WeakMap;function D(e){if(e.parentNode)return e.parentNode;const t=e.getRootNode();return t instanceof ShadowRoot?t.host:null}function E(e){if(!e)return null;if(e instanceof M||e instanceof HTMLElement&&e.tagName.toLowerCase().endsWith("-component"))return e;const t=D(e);return t?E(t):null}let v=!1;function W(){if(v)return;v=!0;const e=["click","change","select","focus","blur","submit","input","keydown","keyup","toggle"],t=["focus","blur"],r=["pointerenter","pointerleave"];for(const n of[...e,...r]){const s=`on:${n}`;document.addEventListener(n,a=>{const i=o(a);if(!i)return;const h=a.target!==i?new Proxy(a,{get(c,q){if(q==="target")return i;const N=Reflect.get(c,q);return typeof N=="function"?N.bind(c):N}}):a,C=i.getAttribute(s)??"";let[p,m]=C.split("/");const k=C.match(/([\/\?][^\/\?]+)([\/\?][^\/\?]+)$/),L=k?k[2]:null,w=p?p.startsWith("#")?document.querySelector(p):i.closest(p):E(i);if(!(w instanceof M)||!m)return;m=m.replace(/\?.*/,"");const A=w[m];if(typeof A=="function")try{const c=[h];L&&c.unshift(V(L)),A.call(w,...c)}catch(c){console.error(c)}},{capture:!0})}function o(n){const s=n.composedPath?.()[0]??n.target;if(s instanceof Element)return s.hasAttribute(`on:${n.type}`)?s:r.includes(n.type)?null:n.bubbles||t.includes(n.type)?s.closest(`[on\\:${n.type}]`):null}}function V(e){const t=e[0],r=e.slice(1);return t==="?"?Object.fromEntries(Array.from(new URLSearchParams(r).entries()).map(([o,n])=>[o,$(n)])):$(r)}function $(e){if(e==="true")return!0;if(e==="false")return!1;const t=Number(e);return!isNaN(t)&&e.trim()!==""?t:e}class j extends Error{constructor(t,r){super(`Required ref "${t}" not found in component ${r.tagName.toLowerCase()}`)}}export{M as C,P as D};
