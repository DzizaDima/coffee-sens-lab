var H=Object.defineProperty;var k=r=>{throw TypeError(r)};var P=(r,s,e)=>s in r?H(r,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[s]=e;var F=(r,s,e)=>P(r,typeof s!="symbol"?s+"":s,e),L=(r,s,e)=>s.has(r)||k("Cannot "+e);var o=(r,s,e)=>(L(r,s,"read from private field"),e?e.call(r):s.get(r)),p=(r,s,e)=>s.has(r)?k("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(r):s.set(r,e),f=(r,s,e,t)=>(L(r,s,"write to private field"),t?t.call(r,e):s.set(r,e),e),n=(r,s,e)=>(L(r,s,"access private method"),e);import{C as U}from"./component.js";import{T as M}from"./events.js";import"./utilities.js";var d,h,u,m,i,g,B,I,T,x,D,$,_,A,q,w,v,z;const l=class l extends U{constructor(){super(...arguments);p(this,i);p(this,d,l.DeliveryMode.SELF);p(this,h,null);p(this,u,null);p(this,m,null);F(this,"requiredRefs",["myEmailButton","recipientEmailButton","recipientFields","recipientEmail","recipientName","recipientMessage","recipientSendOn"])}connectedCallback(){super.connectedCallback(),n(this,i,B).call(this),f(this,h,()=>n(this,i,_).call(this)),this.refs.recipientMessage.addEventListener("input",o(this,h)),f(this,u,n(this,i,q).bind(this)),document.addEventListener(M.cartError,o(this,u)),f(this,m,()=>n(this,i,z).call(this)),document.addEventListener(M.cartUpdate,o(this,m))}disconnectedCallback(){super.disconnectedCallback(),o(this,h)&&(this.refs.recipientMessage.removeEventListener("input",o(this,h)),f(this,h,null)),o(this,u)&&(document.removeEventListener(M.cartError,o(this,u)),f(this,u,null)),o(this,m)&&(document.removeEventListener(M.cartUpdate,o(this,m)),f(this,m,null))}toggleRecipientForm(e,t){if(!Object.values(l.DeliveryMode).includes(e))throw new Error(`Invalid delivery mode: ${e}. Must be one of: ${Object.values(l.DeliveryMode).join(", ")}`);o(this,d)!==e&&(f(this,d,e),n(this,i,I).call(this))}};d=new WeakMap,h=new WeakMap,u=new WeakMap,m=new WeakMap,i=new WeakSet,g=function(){return[this.refs.recipientEmail,this.refs.recipientName,this.refs.recipientMessage,this.refs.recipientSendOn]},B=function(){n(this,i,T).call(this,l.DeliveryMode.SELF),this.refs.recipientFields.hidden=!0,n(this,i,x).call(this),n(this,i,D).call(this),n(this,i,A).call(this)},I=function(){const{DeliveryMode:e}=l,t=o(this,d)===e.RECIPIENT;n(this,i,T).call(this,o(this,d)),this.refs.recipientFields.hidden=!t,t?(n(this,i,$).call(this),n(this,i,_).call(this),this.refs.liveRegion&&(this.refs.liveRegion.textContent=Theme.translations?.recipient_form_fields_visible||"Recipient form fields are now visible"),this.refs.recipientEmail.focus()):(n(this,i,x).call(this),n(this,i,D).call(this),this.refs.liveRegion&&(this.refs.liveRegion.textContent=Theme.translations?.recipient_form_fields_hidden||"Recipient form fields are now hidden")),this.dispatchEvent(new CustomEvent("recipient:toggle",{detail:{mode:o(this,d),recipientFormVisible:t},bubbles:!0}))},T=function(e){const{DeliveryMode:t}=l;switch(e){case t.SELF:this.refs.myEmailButton.checked=!0,this.refs.recipientEmailButton.checked=!1;break;case t.RECIPIENT:this.refs.myEmailButton.checked=!1,this.refs.recipientEmailButton.checked=!0;break;default:console.warn(`Unknown delivery mode: ${e}`),this.refs.myEmailButton.checked=!0,this.refs.recipientEmailButton.checked=!1}},x=function(){for(const e of o(this,i,g))e.value="";n(this,i,_).call(this),n(this,i,v).call(this)},D=function(){for(const t of o(this,i,g))t.disabled=!0,t.removeAttribute("required"),t.removeAttribute("aria-invalid"),t.removeAttribute("aria-describedby");const e=this.querySelector('input[name="properties[__shopify_send_gift_card_to_recipient]"]');e&&e.remove(),this.refs.timezoneOffset&&(this.refs.timezoneOffset.disabled=!0,this.refs.timezoneOffset.value=""),n(this,i,v).call(this)},$=function(){for(const t of o(this,i,g))t.disabled=!1,t===this.refs.recipientEmail&&t.setAttribute("required","required");if(!this.querySelector('input[name="properties[__shopify_send_gift_card_to_recipient]"]')){const t=document.createElement("input");t.type="hidden",t.name="properties[__shopify_send_gift_card_to_recipient]",t.value="on",this.appendChild(t)}this.refs.timezoneOffset&&(this.refs.timezoneOffset.disabled=!1,this.refs.timezoneOffset.value=new Date().getTimezoneOffset().toString()),n(this,i,A).call(this)},_=function(){if(!this.refs.characterCount)return;const e=this.refs.recipientMessage.value.length,t=this.refs.recipientMessage.maxLength,a=this.refs.characterCount.getAttribute("data-template");if(!a)return;const c=a.replace("[current]",e.toString()).replace("[max]",t.toString());this.refs.characterCount.textContent=c},A=function(){const e=new Date,t=new Date;t.setDate(e.getDate()+90);const a=c=>{const E=c.getFullYear(),b=String(c.getMonth()+1).padStart(2,"0"),S=String(c.getDate()).padStart(2,"0");return`${E}-${b}-${S}`};this.refs.recipientSendOn.setAttribute("min",a(e)),this.refs.recipientSendOn.setAttribute("max",a(t))},q=function(e){if(e.detail?.data){const{message:t,errors:a,description:c}=e.detail.data;a&&typeof a=="object"?n(this,i,w).call(this,t||"There was an error",a):t&&n(this,i,w).call(this,t,c)}},w=function(e,t){if(n(this,i,v).call(this),typeof t=="object"&&t!==null){const a={email:{inputRef:"recipientEmail",errorRef:"emailError"},name:{inputRef:"recipientName",errorRef:"nameError"},message:{inputRef:"recipientMessage",errorRef:"messageError"},send_on:{inputRef:"recipientSendOn",errorRef:"sendOnError"}};for(const[c,E]of Object.entries(t)){const b=a[c];if(!b)continue;const{inputRef:S,errorRef:j}=b,y=this.refs[j],C=this.refs[S];if(y&&y instanceof HTMLElement){const R=y.querySelector("span");if(R){const N=Array.isArray(E)?E.join(", "):E;R.textContent=`${N}.`}y.classList.remove("hidden")}if(C&&C instanceof HTMLElement){C.setAttribute("aria-invalid","true");const R=`RecipientForm-${c}-error-${this.dataset.sectionId||"default"}`;C.setAttribute("aria-describedby",R)}}}this.refs.liveRegion&&(this.refs.liveRegion.textContent=e||Theme.translations?.recipient_form_error||"There was an error with the form submission")},v=function(){const e=["emailError","nameError","messageError","sendOnError"];for(const t of e){const a=this.refs[t];if(a&&a instanceof HTMLElement){a.classList.add("hidden");const c=a.querySelector("span");c&&(c.textContent="")}}for(const t of o(this,i,g))t.removeAttribute("aria-invalid"),t.removeAttribute("aria-describedby");this.refs.liveRegion&&(this.refs.liveRegion.textContent="")},z=function(){n(this,i,v).call(this)},F(l,"DeliveryMode",{SELF:"self",RECIPIENT:"recipient_form"});let O=l;customElements.define("gift-card-recipient-form",O);
