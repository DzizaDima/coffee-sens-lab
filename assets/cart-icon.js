var u=Object.defineProperty;var l=(s,e,t)=>e in s?u(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var n=(s,e,t)=>l(s,typeof e!="symbol"?e+"":e,t);import{C as b}from"./component.js";import{o as d}from"./utilities.js";import{T as c}from"./events.js";class C extends b{constructor(){super(...arguments);n(this,"requiredRefs",["cartBubble","cartBubbleText","cartBubbleCount"]);n(this,"onPageShow",t=>{t.persisted&&this.ensureCartBubbleIsCorrect()});n(this,"onCartUpdate",async t=>{const a=t.detail.data?.itemCount??0,r=t.detail.data?.source==="product-form-component";this.renderCartBubble(a,r)});n(this,"renderCartBubble",async(t,a,r=!0)=>{this.refs.cartBubbleCount.classList.toggle("hidden",t===0),this.refs.cartBubble.classList.toggle("visually-hidden",t===0),this.refs.cartBubble.classList.toggle("cart-bubble--animating",t>0&&r),this.currentCartCount=a?this.currentCartCount+t:t,this.classList.toggle("header-actions__cart-icon--has-cart",t>0),sessionStorage.setItem("cart-count",JSON.stringify({value:String(this.currentCartCount),timestamp:Date.now()})),r&&(await d(this.refs.cartBubbleText),this.refs.cartBubble.classList.remove("cart-bubble--animating"))});n(this,"ensureCartBubbleIsCorrect",()=>{if(!this.refs.cartBubbleCount)return;const t=sessionStorage.getItem("cart-count");if(t===null)return;const a=this.refs.cartBubbleCount.textContent;try{const{value:r,timestamp:i}=JSON.parse(t);if(r===a)return;if(Date.now()-i<1e4){const o=parseInt(r,10);o>=0&&this.renderCartBubble(o,!1,!1)}}catch{}})}get currentCartCount(){return parseInt(this.refs.cartBubbleCount.textContent??"0",10)}set currentCartCount(t){this.refs.cartBubbleCount.textContent=t<100?String(t):""}connectedCallback(){super.connectedCallback(),document.addEventListener(c.cartUpdate,this.onCartUpdate),window.addEventListener("pageshow",this.onPageShow),this.ensureCartBubbleIsCorrect()}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener(c.cartUpdate,this.onCartUpdate),window.removeEventListener("pageshow",this.onPageShow)}}customElements.get("cart-icon")||customElements.define("cart-icon",C);
