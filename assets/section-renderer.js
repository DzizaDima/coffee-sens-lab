var m=e=>{throw TypeError(e)};var g=(e,t,n)=>t.has(e)||m("Cannot "+n);var r=(e,t,n)=>(g(e,t,"read from private field"),n?n.call(e):t.get(e)),f=(e,t,n)=>t.has(e)?m("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n);var w=(e,t,n)=>(g(e,t,"access private method"),n);import{m as L}from"./morph.js";import"./utilities.js";import"./component.js";var s,a,h,l,M,y;class R{constructor(){f(this,l);f(this,s,new Map);f(this,a,new Map);f(this,h,new Map);window.addEventListener("load",w(this,l,y).bind(this))}async renderSection(t,n){const{cache:c=!Shopify.designMode}=n??{},{url:o}=n??{};w(this,l,M).call(this,t);const i=new AbortController;r(this,a).set(t,i);const d=await this.getSectionHTML(t,c,o);return i.signal.aborted||(r(this,a).delete(t),T(t,d)),d}async getSectionHTML(t,n=!0,c=new URL(window.location.href)){const o=S(t,c);let i=r(this,h).get(o);if(i)return i;if(n){const u=r(this,s).get(o);if(u)return u}i=fetch(o).then(u=>u.text()),r(this,h).set(o,i);const d=await i;return r(this,h).delete(o),r(this,s).set(o,d),d}}s=new WeakMap,a=new WeakMap,h=new WeakMap,l=new WeakSet,M=function(t){const n=r(this,a).get(t);n&&n.abort()},y=function(){for(const t of document.querySelectorAll(".shopify-section")){const n=S(t.id);if(r(this,s).get(n)||E(t))return;r(this,s).set(n,t.outerHTML)}};const b="shopify-section-";function S(e,t=new URL(window.location.href)){return t.searchParams.set("section_id",P(e)),t.searchParams.sort(),t.toString()}function p(e){return`${b}${e}`}function P(e){return e.replace(new RegExp(`^${b}`),"")}function E(e){return!!e.shadowRoot||Array.from(e.children).some(E)}async function T(e,t){const n=new DOMParser().parseFromString(t,"text/html"),c=document.getElementById(p(e)),o=n.getElementById(p(e));if(!c)throw new Error(`Section ${e} not found`);if(!o)throw new Error(`Section ${e} not found in the section rendering response`);L(c,o)}const A=new R;export{T as m,A as s};
