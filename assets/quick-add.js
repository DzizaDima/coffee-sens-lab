var V=Object.defineProperty;var I=n=>{throw TypeError(n)};var x=(n,o,t)=>o in n?V(n,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[o]=t;var w=(n,o,t)=>x(n,typeof o!="symbol"?o+"":o,t),q=(n,o,t)=>o.has(n)||I("Cannot "+t);var i=(n,o,t)=>(q(n,o,"read from private field"),t?t.call(n):o.get(n)),c=(n,o,t)=>o.has(n)?I("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(n):o.set(n,t),L=(n,o,t,e)=>(q(n,o,"write to private field"),e?e.call(n,t):o.set(n,t),t),u=(n,o,t)=>(q(n,o,"access private method"),t);import{m as B}from"./morph.js";import{C as F}from"./component.js";import{T as p}from"./events.js";import{a as S,D as H}from"./dialog.js";import{m as T,i as N,D as O}from"./utilities.js";var l,h,m,s,A,v,M,b,f,P,Q;class R extends F{constructor(){super(...arguments);c(this,s);c(this,l,null);c(this,h,new Map);c(this,m,new AbortController);c(this,v,()=>{i(this,h).clear()});w(this,"handleClick",async t=>{t.preventDefault();const e=this.productPageUrl;let a=i(this,h).get(e);if(!a){const r=await this.fetchProductPage(e);if(r){const d=r.querySelector("[data-product-grid-content]");d&&(a=d.cloneNode(!0),i(this,h).set(e,a))}}if(a){const r=a.cloneNode(!0);await this.updateQuickAddModal(r)}i(this,b).call(this)});c(this,b,()=>{const t=document.getElementById("quick-add-dialog");t instanceof D&&(u(this,s,M).call(this,t),t.showDialog())});c(this,f,()=>{const t=document.getElementById("quick-add-dialog");t instanceof D&&t.closeDialog()})}get productPageUrl(){const t=this.closest("product-card"),e=this.closest("product-hotspot-component"),a=t?.getProductCardLink()||e?.getHotspotProductLink();if(!a?.href)return"";const r=new URL(a.href);if(r.searchParams.has("variant"))return r.toString();const d=u(this,s,A).call(this);return d&&r.searchParams.set("variant",d),r.toString()}connectedCallback(){super.connectedCallback(),T.addEventListener("change",i(this,f)),document.addEventListener(p.cartUpdate,i(this,v),{signal:i(this,m).signal}),document.addEventListener(p.variantSelected,u(this,s,P).bind(this))}disconnectedCallback(){super.disconnectedCallback(),T.removeEventListener("change",i(this,f)),i(this,l)?.abort(),i(this,m).abort(),document.removeEventListener(p.variantSelected,u(this,s,P).bind(this))}async fetchProductPage(t){if(!t)return null;i(this,l)?.abort(),L(this,l,new AbortController);try{const e=await fetch(t,{signal:i(this,l).signal});if(!e.ok)throw new Error(`Failed to fetch product page: HTTP error ${e.status}`);const a=await e.text();return new DOMParser().parseFromString(a,"text/html")}catch(e){if(e.name==="AbortError")return null;throw e}finally{L(this,l,null)}}async updateQuickAddModal(t){const e=document.getElementById("quick-add-modal-content");if(!(!t||!e)){if(N()){const a=t.querySelector(".product-details"),r=t.querySelector("product-form-component"),d=t.querySelector("variant-picker"),U=t.querySelector("product-price"),y=document.createElement("a");y.textContent=this.dataset.productTitle||"",y.href=this.productPageUrl;const k=document.createElement("div");k.classList.add("product-header"),k.appendChild(y),U&&k.appendChild(U),t.appendChild(k),d&&t.appendChild(d),r&&t.appendChild(r),a?.remove()}B(e,t),u(this,s,Q).call(this,e)}}}l=new WeakMap,h=new WeakMap,m=new WeakMap,s=new WeakSet,A=function(){return this.closest("product-card")?.getSelectedVariantId()||null},v=new WeakMap,M=function(t){this.toggleAttribute("stay-visible",!0),t.addEventListener(S.eventName,()=>this.toggleAttribute("stay-visible",!1),{once:!0})},b=new WeakMap,f=new WeakMap,P=function(t){if(!(t.target instanceof HTMLElement)||t.target.closest("product-card")!==this.closest("product-card"))return;const a=this.dataset.productOptionsCount==="1"?"add":"choose";this.setAttribute("data-quick-add-button",a)},Q=function(t){const e=u(this,s,A).call(this);if(!e)return;const a=t.querySelectorAll('input[type="radio"][data-variant-id]');for(const r of a)if(r instanceof HTMLInputElement&&r.dataset.variantId===e&&!r.checked){r.checked=!0,r.dispatchEvent(new Event("change",{bubbles:!0}));break}};customElements.get("quick-add-component")||customElements.define("quick-add-component",R);var g,E,C;class D extends H{constructor(){super(...arguments);c(this,g,new AbortController);w(this,"handleCartUpdate",t=>{t.detail.data.didError||this.closeDialog()});c(this,E,t=>{const e=t.detail.data.html?.querySelector(".view-product-title a"),a=this.querySelector(".view-product-title a"),r=this.querySelector(".product-header a");e&&(a&&(a.href=e.href),r&&(r.href=e.href))});c(this,C,()=>{const t=O();!t||t.major>=17||t.major===16&&t.minor>=4||requestAnimationFrame(()=>{const e=document.querySelector("#ResultsList [product-grid-view]");if(e){const a=e.getBoundingClientRect().width;e.style.width=`${a-1}px`,requestAnimationFrame(()=>{e.style.width=""})}})})}connectedCallback(){super.connectedCallback(),this.addEventListener(p.cartUpdate,this.handleCartUpdate,{signal:i(this,g).signal}),this.addEventListener(p.variantUpdate,i(this,E)),this.addEventListener(S.eventName,i(this,C))}disconnectedCallback(){super.disconnectedCallback(),i(this,g).abort(),this.removeEventListener(S.eventName,i(this,C))}}g=new WeakMap,E=new WeakMap,C=new WeakMap;customElements.get("quick-add-dialog")||customElements.define("quick-add-dialog",D);
