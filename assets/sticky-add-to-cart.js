var F=Object.defineProperty;var _=r=>{throw TypeError(r)};var P=(r,s,t)=>s in r?F(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var x=(r,s,t)=>P(r,typeof s!="symbol"?s+"":s,t),w=(r,s,t)=>s.has(r)||_("Cannot "+t);var i=(r,s,t)=>(w(r,s,"read from private field"),t?t.call(r):s.get(r)),n=(r,s,t)=>s.has(r)?_("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(r):s.set(r,t),d=(r,s,t,e)=>(w(r,s,"write to private field"),e?e.call(r,t):s.set(r,t),t),u=(r,s,t)=>(w(r,s,"access private method"),t);import{C as R}from"./component.js";import{T as v}from"./events.js";import{m as D}from"./morph.js";import{o as N}from"./utilities.js";var k,b,C,f,B,I,h,y,m,a,Q,T,q,A,g,E,L,O,U,$,S;class j extends R{constructor(){super(...arguments);n(this,a);x(this,"requiredRefs",["stickyBar","addToCartButton","quantityDisplay","quantityNumber"]);n(this,k,null);n(this,b,null);n(this,C);n(this,f,!1);n(this,B,null);n(this,I,new AbortController);n(this,h,null);n(this,y,1);n(this,m,!1);x(this,"handleAddToCartClick",async()=>{if(!i(this,h))return;i(this,h).dataset.puppet="true",i(this,h).click();const t=document.querySelector(".header-actions__cart-icon");if(this.refs.addToCartButton.dataset.added!=="true"&&(this.refs.addToCartButton.dataset.added="true"),!t||!this.refs.addToCartButton||!this.refs.productImage)return;i(this,C)&&clearTimeout(i(this,C));const e=document.createElement("fly-to-cart");getComputedStyle(this.refs.productImage),e.classList.add("fly-to-cart--sticky"),e.style.setProperty("background-image",`url(${this.refs.productImage.src})`),e.useSourceSize="true",e.source=this.refs.productImage,e.destination=t,document.body.appendChild(e),await N([this.refs.addToCartButton,e]),d(this,C,setTimeout(()=>{this.refs.addToCartButton.removeAttribute("data-added")},800))});n(this,T,t=>{if(t.detail.data.productId!==this.dataset.productId)return;const e=t.detail.resource,c=t.detail.data.html.querySelector("sticky-add-to-cart");if(!c)return;const l=c.querySelector('[ref="stickyBar"]');if(!l)return;const o=this.refs.stickyBar.getAttribute("data-stuck")||"false",p=c.dataset.variantAvailable;D(this.refs.stickyBar,l,{childrenOnly:!0}),this.refs.stickyBar.setAttribute("data-stuck",o),this.dataset.variantAvailable=p,e&&e.id&&(this.dataset.currentVariantId=e.id);const V=u(this,a,U).call(this);V&&d(this,h,V.querySelector('[ref="addToCartButton"]')),e==null&&i(this,A).call(this),u(this,a,S).call(this)});n(this,q,t=>{const e=t.detail.resource?.id;e&&(this.dataset.currentVariantId=e)});n(this,A,()=>{this.dataset.currentVariantId="";const t=this.querySelector(".sticky-add-to-cart__variant"),e=this.dataset.productId,c=document.querySelector(`variant-picker[data-product-id="${e}"]`);if(!t||!c)return;const l=Array.from(c.querySelectorAll("input:checked")).map(o=>o.value).filter(o=>o!=="").join(" / ");l&&(t.textContent=l)});n(this,g,t=>{i(this,h)&&(i(this,h).dataset.puppet="false")});n(this,E,t=>{t.detail.cartLine||(d(this,y,t.detail.quantity),u(this,a,S).call(this))})}connectedCallback(){super.connectedCallback(),u(this,a,Q).call(this);const{signal:t}=i(this,I),e=this.closest(".shopify-section");e?.addEventListener(v.variantUpdate,i(this,T),{signal:t}),e?.addEventListener(v.variantSelected,i(this,q),{signal:t}),document.addEventListener(v.cartUpdate,i(this,g),{signal:t}),document.addEventListener(v.cartError,i(this,g),{signal:t}),document.addEventListener(v.quantitySelectorUpdate,i(this,E),{signal:t}),u(this,a,$).call(this)}disconnectedCallback(){super.disconnectedCallback(),i(this,k)?.disconnect(),i(this,b)?.disconnect(),i(this,I).abort(),i(this,B)&&clearTimeout(i(this,B))}}k=new WeakMap,b=new WeakMap,C=new WeakMap,f=new WeakMap,B=new WeakMap,I=new WeakMap,h=new WeakMap,y=new WeakMap,m=new WeakMap,a=new WeakSet,Q=function(){const t=u(this,a,U).call(this);if(!t)return;const e=t.closest(".buy-buttons-block");if(!e)return;const c=document.querySelector("footer");c&&(d(this,k,new IntersectionObserver(l=>{const[o]=l;if(o)if(!o.isIntersecting&&!i(this,f)){const p=o.target.getBoundingClientRect();(p.bottom<0||p.top<0)&&u(this,a,L).call(this)}else o.isIntersecting&&i(this,f)&&(d(this,m,!1),u(this,a,O).call(this))})),d(this,b,new IntersectionObserver(l=>{const[o]=l;if(o){if(o.isIntersecting&&i(this,f))d(this,m,!0),u(this,a,O).call(this);else if(!o.isIntersecting&&i(this,m)){const p=e.getBoundingClientRect();(p.bottom<0||p.top<0)&&(d(this,m,!1),u(this,a,L).call(this))}}},{rootMargin:"200px 0px 0px 0px"})),i(this,k).observe(e),i(this,b).observe(c),d(this,h,t.querySelector('[ref="addToCartButton"]')))},T=new WeakMap,q=new WeakMap,A=new WeakMap,g=new WeakMap,E=new WeakMap,L=function(){const{stickyBar:t}=this.refs;d(this,f,!0),t.dataset.stuck="true"},O=function(){const{stickyBar:t}=this.refs;d(this,f,!1),t.dataset.stuck="false"},U=function(){const t=this.dataset.productId;if(!t)return null;const e=this.closest(".shopify-section");if(!e)return null;const c=e.id.replace("shopify-section-","");return document.querySelector(`#shopify-section-${c} product-form-component[data-product-id="${t}"]`)},$=function(){d(this,y,parseInt(this.dataset.initialQuantity||"1")||1),u(this,a,S).call(this)},S=function(){const{addToCartButton:t,quantityDisplay:e,quantityNumber:c}=this.refs,l=!t.disabled;c.textContent=i(this,y).toString(),l&&i(this,y)>1?e.style.display="inline":e.style.display="none"};customElements.get("sticky-add-to-cart")||customElements.define("sticky-add-to-cart",j);
