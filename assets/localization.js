var W=Object.defineProperty;var T=i=>{throw TypeError(i)};var _=(i,r,t)=>r in i?W(i,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[r]=t;var S=(i,r,t)=>_(i,typeof r!="symbol"?r+"":r,t),F=(i,r,t)=>r.has(i)||T("Cannot "+t);var l=(i,r,t)=>(F(i,r,"read from private field"),t?t.call(i):r.get(i)),d=(i,r,t)=>r.has(i)?T("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(i):r.set(i,t);var L=(i,r,t)=>(F(i,r,"access private method"),t);import{C as x}from"./component.js";import{z as y,o as M,t as $}from"./utilities.js";var b,m,D,H,z,C,v;class B extends x{constructor(){super(...arguments);d(this,m);d(this,b,t=>{const{countryInput:n,countryListItems:e,form:s}=this.refs;switch(t.key){case"ArrowUp":t.preventDefault(),t.stopPropagation(),L(this,m,z).call(this,"UP");break;case"ArrowDown":t.preventDefault(),t.stopPropagation(),L(this,m,z).call(this,"DOWN");break;case"Enter":{t.preventDefault(),t.stopPropagation();const a=e.find(c=>c.getAttribute("aria-selected")==="true");a&&(n.value=a.dataset.value??"",s.submit());break}}this.refs.search&&setTimeout(()=>{const a=this.refs.countryListItems.filter(u=>!u.hasAttribute("hidden")),c=a.findIndex(u=>u===document.activeElement),o=a[c];o?this.refs.search.setAttribute("aria-activedescendant",o.id):this.refs.search.setAttribute("aria-activedescendant","")})});S(this,"selectCountry",(t,n)=>{n.preventDefault();const{countryInput:e,form:s}=this.refs;e.value=t,s?.submit()});d(this,C,t=>{if(t.key==="Enter"){t.preventDefault(),t.stopPropagation();return}l(this,b).call(this,t)});S(this,"focusSearchInput",()=>{const{search:t}=this.refs;t?.focus()});d(this,v,t=>{const n=this.querySelector(".country-filter"),e=t.target instanceof HTMLElement?t.target:null;if(n&&e){const s=e.scrollTop>0;n.classList.toggle("is-scrolled",s)}})}connectedCallback(){super.connectedCallback(),this.refs.search&&this.refs.search.addEventListener("keydown",l(this,C)),this.refs.countryList&&this.refs.countryList.addEventListener("keydown",l(this,b)),this.refs.countryList&&this.refs.countryList.addEventListener("scroll",l(this,v)),setTimeout(()=>this.resizeLanguageInput(),0)}disconnectedCallback(){super.disconnectedCallback(),this.refs.search&&this.refs.search.removeEventListener("keydown",l(this,C)),this.refs.countryList&&this.refs.countryList.removeEventListener("keydown",l(this,b)),this.refs.countryList&&this.refs.countryList.removeEventListener("scroll",l(this,v))}changeLanguage(t){const{form:n,languageInput:e}=this.refs,s=t.target instanceof HTMLSelectElement?t.target.value:null;s&&(e.value=s,this.resizeLanguageInput(),n.submit())}resizeLanguageInput(){const{languageInput:t}=this.refs;if(!t||CSS.supports("field-sizing","content"))return;for(const e of t.options)e.selected||(e.dataset.optionLabel=e.textContent||"",e.innerText="");t.style.width="fit-content";const n=`${Math.ceil(t.offsetWidth)+1}px`;t.offsetWidth>0&&(t.style.width=n);for(const e of t.options)e.dataset.optionLabel&&(e.textContent=e.dataset.optionLabel,delete e.dataset.optionLabel)}filterCountries(){const{countryList:t,countryListItems:n,liveRegion:e,noResultsMessage:s,popularCountries:a,resetButton:c,search:o}=this.refs,{labelResultsCount:u}=this.dataset,h=y(o.value);let f=0;c.toggleAttribute("hidden",!h),a&&a.toggleAttribute("hidden",!!h);const P=this.querySelector(".country-selector-form__wrapper");P&&P.classList.toggle("is-searching",!!h);for(const g of n)if(h===""){g.removeAttribute("hidden");const p=g.querySelector(".country");p&&(p.textContent=p.textContent),f++}else{const p=L(this,m,D).call(this,h,g);if(p.label||p.alias||p.iso||p.currency){g.removeAttribute("hidden");const A=g.querySelector(".country");A&&(A.innerHTML=L(this,m,H).call(this,A.textContent,h)),f++}else g.setAttribute("hidden","")}e&&u&&(e.innerText=u.replace("[count]",`${f}`)),s.hidden=f>0,t.scrollTop=0}resetCountriesFilter(t){const{search:n}=this.refs;t.stopPropagation(),n.value="",this.filterCountries(),n.setAttribute("aria-activedescendant",""),n.focus()}resetForm(){const{search:t}=this.refs;t&&t.value!=""&&(t.value="",this.filterCountries(),t.setAttribute("aria-activedescendant",""))}}b=new WeakMap,m=new WeakSet,D=function(t,n,e={matchLabel:!0,matchAlias:!0,matchIso:!0,matchCurrency:!0,labelMatchStart:!1,aliasExactMatch:!1}){let s={};const{aliases:a,value:c}=n.dataset;if(e.matchLabel){const o=y(n.querySelector(".country")?.textContent??"");if(!o)return s;s.label=e.labelMatchStart?o.startsWith(t):o.includes(t)}if(e.matchCurrency){const o=y(n.querySelector(".localization-form__currency")?.textContent??"");s.currency=o.includes(t)}if(e.matchIso&&(s.iso=y(c??"")==t),e.matchAlias){const o=a?.split(",").map(u=>y(u));if(!o)return s;s.alias=o.length>0&&o.find(u=>e.aliasExactMatch?u===t:u.startsWith(t))!==void 0}return s},H=function(t,n){if(!t||!n)return t??"";const e=y(t),s=y(n),a=e.indexOf(s);if(a===-1)return t;const c=a+s.length,o=t.slice(0,a),u=t.slice(a,c),h=t.slice(c);let f="";return o&&(f+=`<mark>${o}</mark>`),f+=u,h&&(f+=`<mark>${h}</mark>`),f},z=function(t){const{countryListItems:n}=this.refs,e=n.filter(o=>!o.hasAttribute("hidden")),s=e.findIndex(o=>o===document.activeElement),a=e[s];let c;t==="UP"?c=s>0?e[s-1]:e[e.length-1]:c=s<e.length-1?e[s+1]:e[0],a&&a.setAttribute("aria-selected","false"),c?.setAttribute("aria-selected","true"),c?.focus()},C=new WeakMap,v=new WeakMap;var E,k,q,I;class O extends x{constructor(){super(...arguments);d(this,k);S(this,"hidePanel",()=>{this.isHidden||(this.removeEventListener("keyup",l(this,I)),document.removeEventListener("click",l(this,E)),this.refs.button?.setAttribute("aria-expanded","false"),this.refs.panel.setAttribute("hidden",""),this.refs.localizationForm?.resetForm())});d(this,E,t=>{$(t,this)&&this.hidePanel()});d(this,I,t=>{switch(t.key){case"Escape":this.hidePanel(),t.stopPropagation(),this.refs.button?.focus();break}})}get isHidden(){return this.refs.panel.hasAttribute("hidden")}toggleSelector(){return this.isHidden?this.showPanel():this.hidePanel()}showPanel(){this.isHidden&&(this.addEventListener("keyup",l(this,I)),document.addEventListener("click",l(this,E)),this.refs.panel.removeAttribute("hidden"),this.refs.button.setAttribute("aria-expanded","true"),M(this.refs.panel,()=>{L(this,k,q).call(this),this.refs.localizationForm?.focusSearchInput()}))}}E=new WeakMap,k=new WeakSet,q=function(){this.style.setProperty("--width",`${this.refs.localizationForm.offsetWidth}px`)},I=new WeakMap;var w;class U extends x{constructor(){super(...arguments);d(this,w,t=>{const n=this.querySelector(".country-filter"),e=t.target instanceof HTMLElement?t.target:null;if(n&&e){const s=e.scrollTop>0;n.classList.toggle("is-scrolled",s)}})}toggle(t){const{target:n}=t,{localizationForm:e}=this.refs;if(!e||!(n instanceof HTMLDetailsElement))return;const s=e.querySelector(".country-selector-form__wrapper");n.open?(s&&s.addEventListener("scroll",l(this,w)),M(n,e.focusSearchInput)):(s?.removeEventListener("scroll",l(this,w)),e.resetForm())}}w=new WeakMap;customElements.get("localization-form-component")||customElements.define("localization-form-component",B);customElements.get("dropdown-localization-component")||customElements.define("dropdown-localization-component",O);customElements.get("drawer-localization-component")||customElements.define("drawer-localization-component",U);
