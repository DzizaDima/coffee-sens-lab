var q=i=>{throw TypeError(i)};var C=(i,n,t)=>n.has(i)||q("Cannot "+t);var e=(i,n,t)=>(C(i,n,"read from private field"),t?t.call(i):n.get(i)),c=(i,n,t)=>n.has(i)?q("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(i):n.set(i,t);var m=(i,n,t)=>(C(i,n,"access private method"),t);import{C as I}from"./component.js";import{T as k}from"./events.js";import"./utilities.js";var r,h,a,b,P,l,f,g,p;class T extends I{constructor(){super(...arguments);c(this,a);c(this,r,[]);c(this,h,new AbortController);c(this,l,t=>{const s=this.closest("product-form-component");!s||!(t.target instanceof Node)||!s.contains(t.target)||e(this,p).call(this)});c(this,f,()=>{e(this,p).call(this)});c(this,p,()=>{this.updatePriceDisplay()})}connectedCallback(){super.connectedCallback(),m(this,a,b).call(this),m(this,a,P).call(this),e(this,p).call(this)}disconnectedCallback(){super.disconnectedCallback(),e(this,h).abort()}updatePriceDisplay(){if(!e(this,r).length||!this.refs.pricePerItemText)return;const t=m(this,a,g).call(this),s=e(this,r).find(o=>t>=o.quantity)??e(this,r)[e(this,r).length-1];s&&(this.refs.pricePerItemText.innerHTML=`${this.dataset.atText} ${s.price}/${this.dataset.eachText}`)}}r=new WeakMap,h=new WeakMap,a=new WeakSet,b=function(){const t=parseInt(this.dataset.minQuantity||"")||1,{variantPrice:s,priceBreaks:o}=this.dataset;if(s&&e(this,r).push({quantity:t,price:s}),o){const u=JSON.parse(o);for(const{quantity:d,price:y}of u)d&&y&&e(this,r).push({quantity:parseInt(d),price:y})}e(this,r).sort((u,d)=>d.quantity-u.quantity)},P=function(){const{signal:t}=e(this,h);document.addEventListener(k.quantitySelectorUpdate,e(this,l),{signal:t}),document.addEventListener(k.cartUpdate,e(this,f),{signal:t})},l=new WeakMap,f=new WeakMap,g=function(){const s=this.closest("product-form-component")?.querySelector('input[name="quantity"]');if(!s)return 1;const o=parseInt(s.getAttribute("data-cart-quantity")||"0")||0,u=parseInt(s.value)||1;return o+u},p=new WeakMap;customElements.get("price-per-item")||customElements.define("price-per-item",T);
